# OP2_2025 - Система сортировки расчёсткой

Проект предоставляет функционал сортировки массивов методом расчёстки (Comb Sort). Система состоит из двух отдельных сервисов: клиента и сервера, которые могут быть запущены как отдельные контейнеры с использованием Docker Compose.

## Структура проекта

```
OP2_2025/
├── Server/                    # Серверное приложение
│   ├── Modules/              # Модульная система
│   │   ├── Sorting/         # Модуль сортировки расчёсткой
│   │   ├── Logging/         # Модуль логирования
│   │   └── Database/        # Модуль работы с БД
│   ├── Program.cs           # Точка входа сервера
│   ├── appsettings.json     # Конфигурация сервера
│   ├── Server.csproj        # Файл проекта
│   └── Dockerfile           # Docker образ сервера
├── Client/                   # Клиентское приложение
│   ├── Program.cs           # Точка входа клиента
│   ├── Client.csproj        # Файл проекта
│   └── Dockerfile           # Docker образ клиента
├── docker-compose.yml       # Оркестрация сервисов
└── README.md               # Документация
```

## Основные возможности

1. **Сортировка расчёсткой** - эффективный алгоритм сортировки массивов целых чисел
2. **Модульная архитектура** - сервисы организованы в независимые модули
3. **Система логирования** - логи хранятся на сервере, доступны через API
4. **Аутентификация** - система регистрации и входа пользователей
5. **Контейнеризация** - полная поддержка Docker и Docker Compose

## Требования

- Docker и Docker Compose
- .NET 8.0 SDK (для локальной разработки)

## Быстрый старт

### Запуск через Docker Compose

1. Клонируйте репозиторий или убедитесь, что все файлы на месте
2. Запустите сервисы:
   ```bash
   docker-compose up --build
   ```

3. Сервер будет доступен на `http://localhost:5247`
4. Клиент запустится интерактивно

### Локальный запуск (без Docker)

#### Сервер

```bash
cd Server
dotnet restore
dotnet run
```

#### Клиент

```bash
cd Client
dotnet restore
dotnet run
```

## Использование

### Swagger UI - Интерактивная документация API

После запуска сервера вы можете просмотреть и протестировать API через веб-интерфейс Swagger:

1. Откройте браузер и перейдите по адресу: `http://localhost:5247/swagger`
2. Вы увидите интерактивную документацию всех доступных endpoints
3. Можете тестировать API прямо в браузере:
   - Сначала зарегистрируйтесь через `/api/signup` или войдите через `/api/login`
   - После входа cookie будет автоматически сохранён браузером
   - Затем можете использовать защищённые endpoints (например, `/api/sort`)

Swagger UI показывает:
- Все доступные API endpoints
- Описание запросов и ответов
- Примеры данных
- Возможность отправки тестовых запросов

### API Endpoints

#### Сортировка массива
```http
POST /api/sort
Authorization: Required (Cookie-based)
Content-Type: application/json

{
  "array": [5, 2, 8, 1, 9, 3],
  "ascending": true
}
```

Ответ:
```json
{
  "originalArray": [5, 2, 8, 1, 9, 3],
  "sortedArray": [1, 2, 3, 5, 8, 9],
  "ascending": true
}
```

#### Получение логов
```http
GET /api/logs?from=2024-01-01T00:00:00Z&to=2024-01-31T23:59:59Z&level=INFO
Authorization: Required
```

#### Регистрация пользователя
```http
POST /api/signup
Content-Type: application/json

{
  "login": "username",
  "password": "password"
}
```

#### Вход
```http
POST /api/login
Content-Type: application/json

{
  "login": "username",
  "password": "password"
}
```

### Клиентское приложение

После запуска клиента вы увидите меню:

1. **Войти/Зарегистрироваться** - необходимо для доступа к функционалу
2. **Отсортировать массив** - введите числа через пробел и выберите направление сортировки
3. **Просмотреть логи** - посмотрите записи логов за выбранный период

## Модульная система

### Модуль сортировки (CombSortModule)

Реализует алгоритм сортировки расчёсткой с коэффициентом сжатия 1.3.

**Методы:**
- `Sort(int[] array)` - сортировка по возрастанию
- `Sort(int[] array, bool ascending)` - сортировка с выбором направления

### Модуль логирования (LogManager)

Хранит логи в файловой системе на сервере. Логи сохраняются в формате:
- Имя файла: `app_YYYY-MM-DD.log`
- Расположение: `./logs/` (или настроенное в конфигурации)

**Возможности:**
- Запись логов с различными уровнями (DEBUG, INFO, WARNING, ERROR)
- Привязка логов к пользователю
- Получение логов с фильтрацией по дате, уровню, пользователю

### Модуль базы данных (DBManager)

Управляет SQLite базой данных для хранения пользователей.

**Функции:**
- Подключение к БД с автосозданием таблиц
- Добавление пользователей
- Проверка аутентификации
- Хеширование паролей (SHA256)

## Конфигурация

### Сервер (appsettings.json)

```json
{
  "Logging": {
    "Directory": "./logs"
  },
  "Database": {
    "Path": "./data/users.db"
  },
  "Server": {
    "Port": "5247"
  }
}
```

### Переменные окружения

- `PORT` - порт сервера (по умолчанию 5247)
- `SERVER_URL` - URL сервера для клиента (по умолчанию http://localhost:5247)

## Volumes Docker

При использовании Docker Compose создаются следующие volumes:

- `server-data` - хранение базы данных пользователей
- `server-logs` - хранение файлов логов

## Разработка

### Структура модулей

Каждый модуль находится в отдельной директории `Server/Modules/`:
- Модули независимы друг от друга
- Используется dependency injection для внедрения зависимостей
- Все модули регистрируются в `Program.cs` как Singleton

### Добавление нового модуля

1. Создайте директорию в `Server/Modules/`
2. Реализуйте класс модуля
3. Зарегистрируйте в `Program.cs`:
   ```csharp
   builder.Services.AddSingleton<YourModule>();
   ```
4. Используйте через dependency injection в endpoints

## Технологии

- **.NET 8.0** - основная платформа
- **ASP.NET Core** - веб-фреймворк для сервера
- **SQLite** - база данных
- **Docker** - контейнеризация
- **Cookie Authentication** - аутентификация

## Лицензия

См. файл LICENSE
