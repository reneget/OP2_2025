# 🖥️ Client - CLI клиент для сортировки расчёсткой

Консольное приложение для взаимодействия с API сервера сортировки. Предоставляет удобный интерфейс командной строки для сортировки массивов и управления логами.

---

## 📋 Функциональность

### Основные функции

1. **Приветствие и справка**
   - Вывод приветственного сообщения
   - Справка по алгоритму сортировки «расчёсткой»

2. **Аутентификация**
   - Вход в систему
   - Регистрация нового пользователя

3. **Сбор входных данных**
   - Ввод массива вручную с клавиатуры
   - Загрузка массива из файла (абсолютный путь)
   - Валидация формата входных данных

4. **Сортировка данных**
   - Выполнение сортировки на сервере
   - Возможность ручного ввода «шага отбрасывания»
   - Выбор направления сортировки (по возрастанию/убыванию)

5. **Вывод результатов**
   - Отображение результатов сортировки
   - Настройка формата вывода (скрытие полей)
   - Отображение:
     - Исходного массива
     - Отсортированного массива
     - Шага отбрасывания
     - Времени выполнения (мс)
     - Даты и времени завершения

6. **Логирование**
   - Сохранение результатов сортировки в локальные файлы
   - Шифрование данных при сохранении
   - Просмотр локальных логов
   - Просмотр логов с сервера через API

7. **Настройки**
   - Управление настройками вывода
   - Сохранение настроек между сеансами

8. **Обработка ошибок**
   - Автоматические повторные попытки при ошибках сети
   - Логирование ошибок в файл
   - Информирование пользователя об ошибках

---

## 🚀 Запуск

### Требования

- .NET 8.0 SDK
- Windows 10/11
- Запущенный сервер на `http://localhost:5247` (или другой адрес через переменную окружения)

### Локальный запуск

```bash
cd Client
dotnet restore
dotnet run
```

### Настройка URL сервера

По умолчанию клиент подключается к `http://localhost:5247`. Для изменения используйте переменную окружения:

```bash
# Windows PowerShell
$env:SERVER_URL="http://localhost:5247"
dotnet run

# Windows CMD
set SERVER_URL=http://localhost:5247
dotnet run
```

---

## 📖 Использование

### Главное меню

После запуска приложения отображается главное меню:

```
📋 ГЛАВНОЕ МЕНЮ:
───────────────────────────────────────────────────────────
1. 🔐 Вход в систему
2. 📝 Регистрация
3. 🧮 Выполнить сортировку
4. 📊 Просмотр логов
5. ⚙️  Настройки вывода
6. 📖 Показать справку
0. 🚪 Выход
```

### Ввод данных для сортировки

#### Ввод вручную

1. Выберите пункт "3. Выполнить сортировку"
2. Выберите "1. Ввод вручную"
3. Введите массив чисел через пробел или запятую:
   ```
   Массив: 5 2 8 1 9 3
   ```
   или
   ```
   Массив: 5, 2, 8, 1, 9, 3
   ```

#### Загрузка из файла

1. Выберите пункт "3. Выполнить сортировку"
2. Выберите "2. Загрузка из файла"
3. Введите абсолютный путь к файлу:
   ```
   C:\Users\Username\Documents\array.txt
   ```

Формат файла: числа через пробел или запятую, например:
```
5 2 8 1 9 3
```

### Настройка сортировки

После ввода массива:

1. **Направление сортировки:**
   - `1` - по возрастанию (по умолчанию)
   - `2` - по убыванию

2. **Шаг отбрасывания:**
   - Нажмите Enter для автоматического выбора
   - Или введите значение вручную (рекомендуется: размер массива / 1.3)

### Просмотр результатов

После выполнения сортировки отображается результат:

```
═══════════════════════════════════════════════════════════
                    РЕЗУЛЬТАТ СОРТИРОВКИ
═══════════════════════════════════════════════════════════
📥 Исходный массив: [5, 2, 8, 1, 9, 3]
📤 Отсортированный массив: [1, 2, 3, 5, 8, 9]
🔢 Шаг отбрасывания: 4
⏱️  Время выполнения: 2 мс
📅 Дата и время завершения: 2025-12-19 13:30:45
═══════════════════════════════════════════════════════════
```

### Сохранение в лог

После вывода результата предлагается сохранить его в файл:

```
💾 Сохранить результат в файл логов? (y/n) [y]:
```

Логи сохраняются в зашифрованном виде в:
```
%APPDATA%\SortingClient\logs\sort_YYYYMMDD_HHMMSS.json
```

### Просмотр логов

Выберите пункт "4. Просмотр логов":

1. **Локальные логи** - просмотр сохраненных файлов
2. **Логи с сервера** - просмотр через API (требует авторизации)

Для серверных логов можно указать фильтры:
- Начальная дата
- Конечная дата
- Уровень лога (INFO, WARNING, ERROR)

### Настройки вывода

Выберите пункт "5. Настройки вывода" для управления отображаемыми полями:

```
⚙️  НАСТРОЙКИ ВЫВОДА
───────────────────────────────────────────────────────────
Выберите поля, которые нужно скрыть в результате сортировки:

1. Исходный массив: ✅
2. Отсортированный массив: ✅
3. Шаг отбрасывания: ✅
4. Время выполнения: ✅
5. Дата и время завершения: ✅
```

Введите номера полей для переключения (через пробел).

---

## 🔒 Безопасность

### Шифрование данных

- Все локальные логи сохраняются в зашифрованном виде (AES-256)
- Данные защищены при хранении на диске

### Обработка ошибок

- Автоматические повторные попытки при сетевых ошибках (до 3 попыток)
- Логирование всех ошибок в файл:
  ```
  %APPDATA%\SortingClient\error.log
  ```

---

## 📁 Структура файлов

```
Client/
├── Program.cs                    # Главный файл приложения
├── Modules/
│   ├── ValidationModule.cs      # Валидация входных данных
│   ├── EncryptionModule.cs       # Шифрование данных
│   └── HttpClientModule.cs       # HTTP клиент с повторными попытками
├── Client.csproj                 # Файл проекта
└── README.md                     # Документация
```

### Рабочие директории

- **Логи:** `%APPDATA%\SortingClient\logs\`
- **Настройки:** `%APPDATA%\SortingClient\settings.json`
- **Ошибки:** `%APPDATA%\SortingClient\error.log`

---

## 🔧 Разработка

### Сборка проекта

```bash
dotnet build
```

### Запуск в режиме отладки

```bash
dotnet run
```

### Очистка

```bash
dotnet clean
```

---

## 📝 Примечания

- Приложение требует авторизации для выполнения сортировки и просмотра серверных логов
- Локальные логи доступны без авторизации
- Настройки сохраняются автоматически при изменении
- Все даты и время отображаются в формате системы

---

## 🐛 Известные проблемы

- Предупреждения о безопасности пакета System.Text.Json (не критично для работы)
- Требуется ручной ввод пароля (скрывается звездочками)

---

## 📄 Лицензия

См. файл LICENSE в корне проекта.
